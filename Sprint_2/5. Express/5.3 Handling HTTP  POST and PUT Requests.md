### Overview
In this tutorial we will learn how to respond to POST and PUT requests using Express.

### Learning Outcome
- What is a POST request?
- How to create a POST API using Express?
- How to get POST and PUT parameters i.e read data that is sent in the request?
- What is a PUT request?
- How to create a POST API using Express?

### Introduction
- As we have learnt earlier in this sprint. both PUT and POST is the HTTP method that is designed to send loads of data to a server from a specified resource.
- This method allows data to be sent as a package in a separate communication with the processing script. This means that data sent through the POST or the PUT method will not be visible in the URL, as parameters are not sent along with the URI.
- The format of an HTTP POST or the PUT should have HTTP headers, followed by a blank line, followed by the request body. POST request can be used to submit a web form or upload a file, but it is critical to ensure that the receiving application resonates with the format being used. 
- The Content-Type header indicates the type of body in the POST or the PUT request.
- POST vs GET - While the HTTP POST method is used to send data to a server to create or update a resource, the HTTP GET method is used to request data from a specified resource and should have no other effect.
- PUT vs POST
![](./images/putvspost.png)

Let us start by building POST and PUT API's for our project -
Note: We are using same local employees array that we used in the previous chapter.
```js
let employees = [{
    "id": 1,
    "name": "nehal",
    "email": "nehal.g@test.com",
    "phone": 1234567891,
    "address": "Mumbai 400 101",
    "designation": "developer",
    "team": "PNG"
}, {
    "id": 2,
    "name": "ankita",
    "email": "ankita.g@test.com",
    "phone": 1234567891,
    "address": "Mumbai 400 101",
    "designation": "CONSULTANT",
    "team": "CPG"
}];
```

- Defining a POST and the PUT request in express is same as the way you define get request. You have to create instance of express and call get method. 
```
app.post(path, callback [, callback ...]);
app.put(path, callback [, callback ...]);
```
Here is small snippet to demonstrate that.

```
app.post("https://greyatom.com", (request, response) => {
    response.rend("response");
});

// We need id of the source in put request because we want to update a specific resource
app.put("https://greyatom.com/:id", (request, response) => {
    response.rend("response");
});
```

#### How to create a POST API using Express
We need 1 POST end point for our project 
- POST : /employees : Creates a employee
    - This end point will validate the employee data that is sent in the request
    - If the data is valid, it will save the data in the database. i.e create the employee and return the data that was created at the backend which contains the id generated that record
    - If the data is not valid, it will send relevant HTTP status code along with the error message

- In this router, we need to read the employee data, which must be present in the request body. body property of the request objects returns the data that the user has passed along with the request.
- By default parsing of the requets body is disables in express, we need to enable this using 
```js
app.use(express.json());
```

Also by the convention when post an object to the server and the server creates a new object, it should return the object to the client. This is done because whenever a resource/object is created a new id is assigned to it and client might need that id.

```js
app.post("/employees", (request, response) => {
    let employeeData = request.body; // request.body returns the data the client has sent in the request
    let validateData = validateEmployeeData(employeeData);

    if(validateData.valid) { // check if the data sent by client is valid if not send bad request error to the client
        let data = DatabaseOperations.saveEmployee(employeeData);
        if(data) { // check if the data is saved successfully
            response.send(data); // return the saved data with the id that is generated.
        } else { // if not send the error to the client
            response.status(500).send("Error saving employee data in database");
        }    
    } else {
        response.status(400).send(validateData.message); //response.status sets the hhtp status code of the response. By default it is 200. 400 means bad request from the client
    }
});
```

Output:
    ![](../7.%20project/images/6.png)
    ![](../7.%20project/images/7.png)
    ![](../7.%20project/images/8.png)
    ![](../7.%20project/images/9.png)


#### How to create a PUT API using Express
We need the following PUT end point for our project 
- PUT: /employees/{id} : Updates a employee by id
    - Example: /employees/2
    - This end point will validate the employee data.
    - If the data is valid, it will update the data in the database corresponding to that id and return the updated data
    - If the data is not valid, it will send relevant HTTP status code along with the error message

```js
app.put("/employees/:id", (request, response) => {
    let pathParams = request.params; // request.params returns the paths params object. 
    let id = parseInt(pathParams.id); //get id path params
    let employeeData = request.body; // request.body returns the data the client has sent in the request
    let validateData = validateEmployeeData(employeeData);

    if(validateData.valid) { // check if the data sent by user is valid if not send bad request error to the client
        let data = DatabaseOperations.updateEmployee(employeeData);
        if(data) { // check if the data is saved successfully
            response.send(data); // return the saved data with the id that is generated.
        } else { // if not send the error to the client
            response.status(500).send("Error saving employee data in database");
        }    
    } else {
        response.status(400).send(validateData.message); //response.status sets the hhtp status code of the response. By default it is 200. 400 means bad request from the client
    }
});
```

Output: 
    ![](../7.%20project/images/10.png)
    ![](../7.%20project/images/11.png)
    ![](../7.%20project/images/12.png)

### What you must do
- Read [What does body-parser do with express?](https://stackoverflow.com/questions/38306569/what-does-body-parser-do-with-express).
- Read about [body-parser module in express](https://expressjs.com/en/resources/middleware/body-parser.html).
- Read [How bodyParser() works](https://medium.com/@adamzerner/how-bodyparser-works-247897a93b90).
- Read about [express.json()](https://expressjs.com/en/api.html#express.json)
- Watch this video revise the [Rest Concepts and further watch on how to write a POST and PUT API in Express](https://www.youtube.com/watch?v=pKd0Rpw7O48&t=65s). Skip the first 30 minutes of the video and watch the later part.
- Watch this video on [Handling POST Requests](https://www.youtube.com/watch?v=rin7gb9kdpk). Watch only first 30 mins of the video.

### Additional Resources
- Read this article which explains the [Difference between the http requests POST and GET](https://medium.com/@LazaroIbanez/difference-between-the-http-requests-post-and-get-3b4ed40164c1)